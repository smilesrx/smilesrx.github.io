---
typora-root-url: Image
---

# C库IO函数的工作流程

![C库IO函数的工作流程](/C库IO函数的工作流程.png)

# C语言操作文件相关的问题

使用fopen函数打开一个文件，返回一个FILE *fp，这个指针指向的结构体有三个重要的成员：

* 文件描述符：通过文件描述符可以找到文件的inode，通过inode可以找到对应的数据块
* 文件指针：读和写共享一个文件指针，读或写都会引起指针的变化
* 文件缓冲区：读或者写会先通过文件缓冲区，主要的目的是为了减少对磁盘的读写次数，提高读写磁盘的效率。

# C库函数与系统函数的关系

<img src="/C库函数与系统函数的关系.png" alt="C库函数与系统函数的关系" style="zoom:40%;" />

系统调用：有操作系统实现提供给外部应用程序的编程接口，是应用程序之间数据交换的桥梁。

**库函数和系统函数的关系是: 调用和被调用的关系;库函数是对系统函数的进一步封装.**

# 虚拟地址空间

<img src="/虚拟地址空间.png" alt="虚拟地址空间" style="zoom: 50%;" />

进程的虚拟地址空间分为用户区和内核区，其中内核区是受保护的，用户区是不能够对其进行读写操作的；

内核区中很重要的一个就是进程管理，进程管理中有一个区域就是PCB（本质是一个结构体）；PCB中有文件描述符表，文件描述符表中存放着打开的文件描述符，涉及到文件的IO操作都会用到这个文件描述符。

# PCB和文件描述符表

![PCB和文件描述符表](/PCB和文件描述符表.png)

pcb：结构体：task_struct

一个进程有一个文件描述符表：1024

* 前三个被占用，分别是：STDIN_FILENO，STDOUT_FILENO，STDERR_FILENO
* 文件描述符作用：通过文件描述符找到文件inode，通过inode找到磁盘数据块。

虚拟地址空间----->内核区----->pcb---->文件描述符----->文件IO操作使用文件描述符